<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Цікаві факти</title>
    <style>
        /* Загальні стилі */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f5;
            color: #333;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        /* Заголовок */
        h1 {
            background: linear-gradient(135deg, #007bff, #00d4ff);
            color: white;
            padding: 15px;
            margin: 0;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Форма для реєстрації та входу */
        form {
            background: white;
            padding: 15px;
            margin: 20px auto;
            max-width: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        input {
            padding: 10px;
            border: 2px solid #007bff;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: #0056b3;
        }

        /* Список фактів */
        #factList {
            max-width: 600px;
            margin: 20px auto;
        }

        .fact {
            background: white;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            text-align: left;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: #ff4d4d;
            font-size: 18px;
            cursor: pointer;
            transition: 0.3s;
        }

        .delete-btn:hover {
            color: #cc0000;
        }

        /* Адаптивність */
        @media (max-width: 500px) {
            form {
                flex-direction: column;
            }

            input {
                width: 100%;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Цікаві факти</h1>

    <!-- Форма реєстрації -->
    <div id="registerForm">
        <h2>Реєстрація</h2>
        <form id="registrationForm">
            <input type="email" id="registerEmail" placeholder="Введіть email" required>
            <input type="password" id="registerPassword" placeholder="Введіть пароль" required>
            <button type="submit">Зареєструватися</button>
        </form>
    </div>

    <!-- Форма входу -->
    <div id="loginForm">
        <h2>Вхід</h2>
        <form id="loginFormInner">
            <input type="email" id="loginEmail" placeholder="Введіть email" required>
            <input type="password" id="loginPassword" placeholder="Введіть пароль" required>
            <button type="submit">Увійти</button>
        </form>
    </div>

    <!-- Форма додавання фактів (з'являється після входу) -->
    <form id="factForm" style="display:none;">
        <input type="text" id="factInput" placeholder="Введіть цікавий факт..." required>
        <button type="submit">Додати</button>
    </form>

    <div id="factList"></div>

    <!-- Підключення Firebase SDK через модулі -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // Firebase конфігурація
        const firebaseConfig = {
            apiKey: "AIzaSyBkPYP3bnDy61NFjRSboRZrfTVNTdIMWbY",
            authDomain: "videovortex-235cd.firebaseapp.com",
            databaseURL: "https://videovortex-235cd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "videovortex-235cd",
            storageBucket: "videovortex-235cd.appspot.com",
            messagingSenderId: "681594250269",
            appId: "1:681594250269:web:1176b21fcc8fe2a7d052f4"
        };

        // Ініціалізація Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        document.addEventListener("DOMContentLoaded", () => {
            const factForm = document.getElementById("factForm");
            const factInput = document.getElementById("factInput");
            const factList = document.getElementById("factList");
            const registerForm = document.getElementById("registrationForm");
            const loginForm = document.getElementById("loginFormInner");
            const registerEmail = document.getElementById("registerEmail");
            const registerPassword = document.getElementById("registerPassword");
            const loginEmail = document.getElementById("loginEmail");
            const loginPassword = document.getElementById("loginPassword");

            // Обробка реєстрації
            registerForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const email = registerEmail.value;
                const password = registerPassword.value;
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        console.log("Користувач зареєстрований:", userCredential.user);
                        registerForm.reset();
                    })
                    .catch((error) => {
                        console.error("Помилка реєстрації:", error);
                    });
            });

            // Обробка входу
            loginForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const email = loginEmail.value;
                const password = loginPassword.value;
                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        console.log("Користувач увійшов:", userCredential.user);
                        // Показуємо форму для додавання фактів
                        document.getElementById("factForm").style.display = "block";
                        document.getElementById("registerForm").style.display = "none";
                        document.getElementById("loginForm").style.display = "none";
                    })
                    .catch((error) => {
                        console.error("Помилка входу:", error);
                    });
            });

            // Додавання факту в Firestore
            factForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const factText = factInput.value.trim();

                if (factText) {
                    addDoc(collection(db, "facts"), {
                        text: factText,
                        timestamp: new Date()
                    }).then(() => {
                        factInput.value = ""; // Очищаємо поле після додавання
                    }).catch(error => console.error("Помилка:", error));
                }
            });

            // Завантаження фактів
            function loadFacts() {
                const q = query(collection(db, "facts"), orderBy("timestamp", "desc"));
                onSnapshot(q, (snapshot) => {
                    factList.innerHTML = ""; // Очищаємо список перед додаванням нових фактів
                    snapshot.forEach((doc) => {
                        const factData = doc.data();
                        const factElement = document.createElement("div");
                        factElement.classList.add("fact");
                        factElement.innerHTML = `
                            <p>${factData.text}</p>
                            <button class="delete-btn" data-id="${doc.id}">&times;</button>
                        `;
                        factList.appendChild(factElement);
                    });

                    // Додавання обробників подій для кнопок видалення
                    document.querySelectorAll(".delete-btn").forEach((button) => {
                        button.addEventListener("click", (e) => {
                            const factId = e.target.getAttribute("data-id");
                            deleteDoc(doc(db, "facts", factId)).catch(error => console.error("Помилка видалення:", error));
                        });
                    });
                });
            }

            loadFacts(); // Завантажити факти після завантаження сторінки
        });
    </script>
</body>
</html>
